
> @qwen-team/service@0.3.0 start
> node dist/index.js

[dotenv@17.2.3] injecting env (31) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
üî• CONFIG.TS LOADED - ENV VARS: {
  BACKEND_URL: 'http://localhost:8000',
  ACP_WEBSOCKET_URL: 'ws://localhost:8001'
}
[2026-01-02T09:35:41.837Z] [INFO] UI Server configuration loaded {
  port: 8002,
  env: 'development',
  baseUrl: 'http://localhost:8002',
  corsOrigin: 'http://localhost:8003'
}
[2026-01-02T09:35:41.838Z] [INFO] EnhancedAIService initialized {
  agentEndpoint: 'ws://localhost:8001',
  maxSessions: 1000,
  teamFeatures: true,
  telemetry: true
}
[2026-01-02T09:35:41.838Z] [INFO] AI Service initialized with ACP { agentEndpoint: 'ws://localhost:8001' }
[2026-01-02T09:35:41.838Z] [INFO] AIService initialized { model: 'qwen/qwen-coder', maxSessions: 100 }
[2026-01-02T09:35:41.838Z] [INFO] Direct AIService initialized for shell commands
üî• INDEX.TS LOADED - TESTING COMPILATION
Loaded 1 agent configurations
Loaded 1 agent configurations
üê≥ Sandbox cleanup task started (timeout: 60m, interval: 5m)
üìã Registering routes...
‚úÖ Routes registered
üîå Setting up WebSocket...
‚úÖ WebSocket setup complete
üöÄ About to call app.listen()...
üîå Calling app.listen with port: 8002
‚úÖ app.listen() returned successfully
[2026-01-02T09:35:41.853Z] [INFO] UI Server started successfully { port: 8002, host: '0.0.0.0' }
[2026-01-02T09:35:53.206Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'POST',
  url: '/api/auth/login',
  userId: 'anonymous',
  statusCode: 200,
  duration: '55ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:53.222Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/team/list',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '6ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.101Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'POST',
  url: '/api/team/select',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '4ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.120Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/files/list?workspace_type=team',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '5ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.129Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/teams/my-teams',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '12ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.129Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/todos',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '11ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.131Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/user/profile',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '12ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[2026-01-02T09:35:55.139Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/team/active',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '4ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
[SessionRoute] Creating session with workingDirectory: /workspace
[SessionRoute] Creating session with workingDirectory: /workspace
[2026-01-02T09:35:55.957Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'GET',
  url: '/api/conversations/list',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '3ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
Selected agent: qwen-core-primary at ws://localhost:8001
Selected agent: qwen-core-primary at ws://localhost:8001
[AUTH] Authenticating socket: f9-mpk4w0ejKCMixAAAC
[AUTH] Token present: true
[AUTH] Authentication successful for user: 695099320356ef030062423b
[2026-01-02T09:35:55.962Z] [INFO] Client connected via optimized WebSocket
Sending ACP message: {
  "id": "oKcKQ_JTIbVKQSNeCoAVJ",
  "type": "session",
  "data": {
    "action": "create",
    "userId": "695099320356ef030062423b",
    "workingDirectory": "/workspace"
  },
  "timestamp": 1767346555968
}
Sending ACP message: {
  "id": "KviumjZpd3dnLEg0FOsmc",
  "type": "session",
  "data": {
    "action": "create",
    "userId": "695099320356ef030062423b",
    "workingDirectory": "/workspace"
  },
  "timestamp": 1767346555968
}
ACP Response received: {
  "id": "oKcKQ_JTIbVKQSNeCoAVJ",
  "success": true,
  "data": {
    "session": {
      "sessionId": "EyBsOhH2aNCFzWW-7mNlq",
      "userId": "695099320356ef030062423b"
    }
  },
  "timestamp": 1767346555991
}
Creating session for user 695099320356ef030062423b: EyBsOhH2aNCFzWW-7mNlq (attempt 1)
[2026-01-02T09:35:55.992Z] [INFO] HTTP Request {
  method: 'RequestLogger.logRequest',
  service: 'team-service',
  httpMethod: 'POST',
  url: '/api/sessions',
  userId: '695099320356ef030062423b',
  statusCode: 200,
  duration: '41ms',
  userAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36',
  ip: '127.0.0.1',
  error: undefined
}
ACP Response received: {
  "id": "KviumjZpd3dnLEg0FOsmc",
  "success": true,
  "data": {
    "session": {
      "sessionId": "q5lq5a0weVji-zQslzM4V",
      "userId": "695099320356ef030062423b"
    }
  },
  "timestamp": 1767346555992
}
Creating session for user 695099320356ef030062423b: q5lq5a0weVji-zQslzM4V (attempt 1)
[SOCKET EVENT] ai_chat [
  {
    "userId": "demo",
    "sessionId": "q5lq5a0weVji-zQslzM4V",
    "message": "!pwd",
    "messageId": "1767346560164"
  }
]
[WEBSOCKET] Received ai_chat event: {
  "userId": "demo",
  "sessionId": "q5lq5a0weVji-zQslzM4V",
  "message": "!pwd",
  "messageId": "1767346560164"
}
[WEBSOCKET] Processing ai_chat for userId: 695099320356ef030062423b sessionId: q5lq5a0weVji-zQslzM4V
[WEBSOCKET] Direct shell command: pwd
ToolRegistry created [
  'task',
  'list_directory',
  'read_file',
  'grep_search',
  'glob',
  'edit',
  'write_file',
  'read_many_files',
  'run_shell_command',
  'save_memory',
  'todo_write',
  'exit_plan_mode',
  'web_fetch'
]
[ServerClient] Initialized with 13 tools
[2026-01-02T09:36:00.200Z] [INFO] AI client created { userId: '695099320356ef030062423b', totalSessions: 1 }
[ServerClient] executeShellCommand called: pwd
üê≥ [SandboxedToolExecutor] Processing tool requests: 1
üê≥ Executing in persistent container: pwd
üê≥ Starting sandbox for user 695099320356ef030062423b
üê≥ ‚úÖ Started existing container: qwen-sandbox-695099320356ef030062423b
üê≥ [SandboxedToolExecutor] Returning results: 1
[ServerClient] Sandbox execution complete: [
  {
    id: 'shell-1767346560200',
    callId: 'shell-1767346560200',
    responseParts: [ [Object] ],
    resultDisplay: '/workspace\n',
    error: undefined,
    errorType: undefined
  }
]
[WEBSOCKET] Shell command result: /workspace

[WEBSOCKET] Emitted shell command result
[SOCKET EVENT] ai_chat [
  {
    "userId": "demo",
    "sessionId": "q5lq5a0weVji-zQslzM4V",
    "message": "!ls -all",
    "messageId": "1767346563363"
  }
]
[WEBSOCKET] Received ai_chat event: {
  "userId": "demo",
  "sessionId": "q5lq5a0weVji-zQslzM4V",
  "message": "!ls -all",
  "messageId": "1767346563363"
}
[WEBSOCKET] Processing ai_chat for userId: 695099320356ef030062423b sessionId: q5lq5a0weVji-zQslzM4V
[WEBSOCKET] Direct shell command: ls -all
[ServerClient] executeShellCommand called: ls -all
üê≥ [SandboxedToolExecutor] Processing tool requests: 1
üê≥ Executing in persistent container: ls -all
üê≥ [SandboxedToolExecutor] Returning results: 1
[ServerClient] Sandbox execution complete: [
  {
    id: 'shell-1767346563363',
    callId: 'shell-1767346563363',
    responseParts: [ [Object] ],
    resultDisplay: 'total 16\n' +
      'drwxrwxrwx 2 node node 4096 Jan  2 08:59 .\n' +
      'drwxr-xr-x 1 root root 4096 Jan  2 05:09 ..\n' +
      '-rw-rw-r-- 1 node node  141 Jan  1 01:44 README.md\n' +
      '-rw-rw-r-- 1 node node 2596 Jan  2 09:07 quick_sort.py\n' +
      '-rw-r--r-- 1 node node    0 Jan  1 05:49 test.txt\n',
    error: undefined,
    errorType: undefined
  }
]
[WEBSOCKET] Shell command result: total 16
drwxrwxrwx 2 node node 4096 Jan  2 08:59 .
drwxr-xr-x 1 root root 4096 Jan  2 05:09 ..
-rw-rw-r-- 1 node node  141 Jan  1 01:44 README.md
-rw-rw-r-- 1 node node 2596 Jan  2 09:07 quick_sort.py
-rw-r--r-- 1 node node    0 Jan  1 05:49 test.txt

[WEBSOCKET] Emitted shell command result
[SOCKET EVENT] ai_chat [
  {
    "userId": "demo",
    "sessionId": "q5lq5a0weVji-zQslzM4V",
    "message": "!lscpu",
    "messageId": "1767346571100"
  }
]
[WEBSOCKET] Received ai_chat event: {
  "userId": "demo",
  "sessionId": "q5lq5a0weVji-zQslzM4V",
  "message": "!lscpu",
  "messageId": "1767346571100"
}
[WEBSOCKET] Processing ai_chat for userId: 695099320356ef030062423b sessionId: q5lq5a0weVji-zQslzM4V
[WEBSOCKET] Direct shell command: lscpu
[ServerClient] executeShellCommand called: lscpu
üê≥ [SandboxedToolExecutor] Processing tool requests: 1
üê≥ Executing in persistent container: lscpu
üê≥ [SandboxedToolExecutor] Returning results: 1
[ServerClient] Sandbox execution complete: [
  {
    id: 'shell-1767346571100',
    callId: 'shell-1767346571100',
    responseParts: [ [Object] ],
    resultDisplay: 'Architecture:                            x86_64\n' +
      'CPU op-mode(s):                          32-bit, 64-bit\n' +
      'Address sizes:                           48 bits physical, 48 bits virtual\n' +
      'Byte Order:                              Little Endian\n' +
      'CPU(s):                                  24\n' +
      'On-line CPU(s) list:                     0-23\n' +
      'Vendor ID:                               AuthenticAMD\n' +
      'Model name:                              AMD Ryzen 9 9900X 12-Core Processor\n' +
      'CPU family:                              26\n' +
      'Model:                                   68\n' +
      'Thread(s) per core:                      2\n' +
      'Core(s) per socket:                      12\n' +
      'Socket(s):                               1\n' +
      'Stepping:                                0\n' +
      'Frequency boost:                         enabled\n' +
      'CPU(s) scaling MHz:                      74%\n' +
      'CPU max MHz:                             5751.1821\n' +
      'CPU min MHz:                             623.6230\n' +
      'BogoMIPS:                                8782.92\n' +
      'Flags:                                   fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good amd_lbr_v2 nopl xtopology nonstop_tsc cpuid extd_apicid aperfmperf rapl pni pclmulqdq monitor ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs skinit wdt tce topoext perfctr_core perfctr_nb bpext perfctr_llc mwaitx cpuid_fault cpb cat_l3 cdp_l3 hw_pstate ssbd mba perfmon_v2 ibrs ibpb stibp ibrs_enhanced vmmcall fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid cqm rdt_a avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local user_shstk avx_vnni avx512_bf16 clzero irperf xsaveerptr rdpru wbnoinvd cppc arat npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold avic v_vmsave_vmload vgif x2avic v_spec_ctrl vnmi avx512vbmi umip pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect movdiri movdir64b overflow_recov succor smca fsrm avx512_vp2intersect flush_l1d amd_lbr_pmc_freeze\n' +
      'Virtualization:                          AMD-V\n' +
      'L1d cache:                               576 KiB (12 instances)\n' +
      'L1i cache:                               384 KiB (12 instances)\n' +
      'L2 cache:                                12 MiB (12 instances)\n' +
      'L3 cache:                                64 MiB (2 instances)\n' +
      'NUMA node(s):                            1\n' +
      'NUMA node0 CPU(s):                       0-23\n' +
      'Vulnerability Gather data sampling:      Not affected\n' +
      'Vulnerability Ghostwrite:                Not affected\n' +
      'Vulnerability Indirect target selection: Not affected\n' +
      'Vulnerability Itlb multihit:             Not affected\n' +
      'Vulnerability L1tf:                      Not affected\n' +
      'Vulnerability Mds:                       Not affected\n' +
      'Vulnerability Meltdown:                  Not affected\n' +
      'Vulnerability Mmio stale data:           Not affected\n' +
      'Vulnerability Old microcode:             Not affected\n' +
      'Vulnerability Reg file data sampling:    Not affected\n' +
      'Vulnerability Retbleed:                  Not affected\n' +
      'Vulnerability Spec rstack overflow:      Mitigation; IBPB on VMEXIT only\n' +
      'Vulnerability Spec store bypass:         Mitigation; Speculative Store Bypass disabled via prctl\n' +
      'Vulnerability Spectre v1:                Mitigation; usercopy/swapgs barriers and __user pointer sanitization\n' +
      'Vulnerability Spectre v2:                Mitigation; Enhanced / Automatic IBRS; IBPB conditional; STIBP always-on; PBRSB-eIBRS Not affected; BHI Not affected\n' +
      'Vulnerability Srbds:                     Not affected\n' +
      'Vulnerability Tsa:                       Not affected\n' +
      'Vulnerability Tsx async abort:           Not affected\n' +
      'Vulnerability Vmscape:                   Mitigation; IBPB on VMEXIT\n',
    error: undefined,
    errorType: undefined
  }
]
[WEBSOCKET] Shell command result: Architecture:                            x86_64
CPU op-mode(s):                          32-bit, 64-bit
Address sizes:                           48 bits physical, 48 bits virtual
Byte Order:                              Little Endian
CPU(s):                                  24
On-line CPU(s) list:                     0-23
Vendor ID:                               AuthenticAMD
Model name:                              AMD Ryzen 9 9900X 12-Core Processor
CPU family:                              26
Model:                                   68
Thread(s) per core:                      2
Core(s) per socket:                      12
Socket(s):                               1
Stepping:                                0
Frequency boost:                         enabled
CPU(s) scaling MHz:                      74%
CPU max MHz:                             5751.1821
CPU min MHz:                             623.6230
BogoMIPS:                                8782.92
Flags:                                   fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good amd_lbr_v2 nopl xtopology nonstop_tsc cpuid extd_apicid aperfmperf rapl pni pclmulqdq monitor ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs skinit wdt tce topoext perfctr_core perfctr_nb bpext perfctr_llc mwaitx cpuid_fault cpb cat_l3 cdp_l3 hw_pstate ssbd mba perfmon_v2 ibrs ibpb stibp ibrs_enhanced vmmcall fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid cqm rdt_a avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local user_shstk avx_vnni avx512_bf16 clzero irperf xsaveerptr rdpru wbnoinvd cppc arat npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold avic v_vmsave_vmload vgif x2avic v_spec_ctrl vnmi avx512vbmi umip pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect movdiri movdir64b overflow_recov succor smca fsrm avx512_vp2intersect flush_l1d amd_lbr_pmc_freeze
Virtualization:                          AMD-V
L1d cache:                               576 KiB (12 instances)
L1i cache:                               384 KiB (12 instances)
L2 cache:                                12 MiB (12 instances)
L3 cache:                                64 MiB (2 instances)
NUMA node(s):                            1
NUMA node0 CPU(s):                       0-23
Vulnerability Gather data sampling:      Not affected
Vulnerability Ghostwrite:                Not affected
Vulnerability Indirect target selection: Not affected
Vulnerability Itlb multihit:             Not affected
Vulnerability L1tf:                      Not affected
Vulnerability Mds:                       Not affected
Vulnerability Meltdown:                  Not affected
Vulnerability Mmio stale data:           Not affected
Vulnerability Old microcode:             Not affected
Vulnerability Reg file data sampling:    Not affected
Vulnerability Retbleed:                  Not affected
Vulnerability Spec rstack overflow:      Mitigation; IBPB on VMEXIT only
Vulnerability Spec store bypass:         Mitigation; Speculative Store Bypass disabled via prctl
Vulnerability Spectre v1:                Mitigation; usercopy/swapgs barriers and __user pointer sanitization
Vulnerability Spectre v2:                Mitigation; Enhanced / Automatic IBRS; IBPB conditional; STIBP always-on; PBRSB-eIBRS Not affected; BHI Not affected
Vulnerability Srbds:                     Not affected
Vulnerability Tsa:                       Not affected
Vulnerability Tsx async abort:           Not affected
Vulnerability Vmscape:                   Mitigation; IBPB on VMEXIT

[WEBSOCKET] Emitted shell command result
Sending ACP message: {
  "id": "wvhrh_INfWJlA4t3fN0Pn",
  "type": "session",
  "data": {
    "action": "getStats",
    "sessionId": "q5lq5a0weVji-zQslzM4V",
    "userId": "695099320356ef030062423b"
  },
  "timestamp": 1767346601848
}
ACP Response received: {
  "id": "wvhrh_INfWJlA4t3fN0Pn",
  "success": true,
  "data": {
    "stats": {
      "sessionId": "q5lq5a0weVji-zQslzM4V",
      "userId": "695099320356ef030062423b",
      "messageCount": 0,
      "tokenUsage": {
        "inputTokens": 0,
        "outputTokens": 0,
        "totalTokens": 0
      },
      "createdAt": "2026-01-02T09:35:55.992Z",
      "lastActivity": "2026-01-02T09:35:55.992Z"
    }
  },
  "timestamp": 1767346601848
}
